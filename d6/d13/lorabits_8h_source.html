<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDRAngel: plugins/channelrx/demodlora/lorabits.h Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../sdrangel_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDRAngel
   &#160;<span id="projectnumber">4.11.5</span>
   </div>
   <div id="projectbrief">Developer docs for &lt;a href=&quot;https://github.com/f4exb/sdrangel&quot;&gt;SDRangel&lt;\a&gt;, an Open Source Qt5 / OpenGL 3.0+ SDR and signal analyzer frontend to various hardware.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_38c8d24aef3972a7f87b834274e76e31.html">plugins</a></li><li class="navelem"><a class="el" href="../../dir_6e513960e68e46b2e554ba62bddfbfbf.html">channelrx</a></li><li class="navelem"><a class="el" href="../../dir_b5688de4b027400f87ca9562d4d1e66a.html">demodlora</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">lorabits.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d6/d13/lorabits_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> Interleaving is &quot;easiest&quot; if the same number of bits is used per symbol as for FEC</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> Chosen mode &quot;spreading 8, low rate&quot; has 6 bits per symbol, so use 4:6 FEC</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> More spreading needs higher frequency resolution and longer time on air, increasing drift errors.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> Want higher bandwidth when using more spreading, which needs more CPU and a better FFT.</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> Six bit Hamming can only correct long runs of drift errors when not using interleaving. Interleaving defeats the point of using Gray code and puts multiple bit errors into single FEC blocks. Hardware decoding uses RSSI to detect the symbols most likely to be damaged, so that individual bits can be repaired after de-interleaving. </span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> Using Implicit Mode: explicit starts with a 4:8 block and seems to have a different whitening sequence.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// Six bits per symbol, six chars per block</span></div><div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="../../d7/d10/classLoRaDemod.html#ac0ab0c757e48da317954cfd3b1bd770d">   14</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d10/classLoRaDemod.html#ac0ab0c757e48da317954cfd3b1bd770d">LoRaDemod::interleave6</a>(<span class="keywordtype">char</span>* inout, <span class="keywordtype">int</span> size)</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;{</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>, j;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <span class="keywordtype">char</span> in[6 * 2];</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <span class="keywordtype">short</span> s;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keywordflow">for</span> (j = 0; j &lt; size; j+=6) {</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++)</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;            in[i] = in[i + 6] = inout[i + j];</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="comment">// top bits are swapped</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; 6; i++) {</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;            s = (32 &amp; in[2 + <a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>]) | (16 &amp; in[1 + i]) | (8 &amp; in[3 + <a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>])</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                | (4 &amp; in[4 + i]) | (2 &amp; in[5 + <a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>]) | (1 &amp; in[6 + i]);</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;            <span class="comment">// bits are also  rotated</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;            s = (s &lt;&lt; 3) | (s &gt;&gt; 3);</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;            s &amp;= 63;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;            s = (s &gt;&gt; <a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>) | (s &lt;&lt; (6 - i));</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;            inout[i + j] = s &amp; 63;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        }</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    }</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;}</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="../../d7/d10/classLoRaDemod.html#addeae1bb2a2d6c00227b5788f819c7cf">   36</a></span>&#160;<span class="keywordtype">short</span> <a class="code" href="../../d7/d10/classLoRaDemod.html#addeae1bb2a2d6c00227b5788f819c7cf">LoRaDemod::toGray</a>(<span class="keywordtype">short</span> num)</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="keywordflow">return</span> (num &gt;&gt; 1) ^ num;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;}</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">// Ignore the FEC bits, just extract the data bits</span></div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="../../d7/d10/classLoRaDemod.html#a9495b2c00add0f711d7af99c59954f40">   42</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d10/classLoRaDemod.html#a9495b2c00add0f711d7af99c59954f40">LoRaDemod::hamming6</a>(<span class="keywordtype">char</span>* c, <span class="keywordtype">int</span> size)</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; size; i++) {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] = ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 1)&lt;&lt;3) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 2)&lt;&lt;0) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 4)&gt;&gt;0) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 8)&gt;&gt;3);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        i++;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] = ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 1)&lt;&lt;2) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 2)&lt;&lt;2) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 4)&gt;&gt;1) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 8)&gt;&gt;3);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        i++;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] = ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp;32)&gt;&gt;2) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 2)&lt;&lt;1) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 4)&gt;&gt;1) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 8)&gt;&gt;3);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        i++;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] = ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 1)&lt;&lt;3) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 2)&lt;&lt;1) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 4)&gt;&gt;1) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 8)&gt;&gt;3);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        i++;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] = ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 1)&lt;&lt;3) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 2)&lt;&lt;1) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 4)&gt;&gt;1) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp;16)&gt;&gt;4);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        i++;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] = ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 1)&lt;&lt;3) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 2)&lt;&lt;1) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 4)&gt;&gt;2) | ((c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] &amp; 8)&gt;&gt;2);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    }</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    c[<a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>] = 0;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">// data whitening (6 bit)</span></div><div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="../../d7/d10/classLoRaDemod.html#a01918e51fd137fd09c4a0db3b5b935f0">   63</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d10/classLoRaDemod.html#a01918e51fd137fd09c4a0db3b5b935f0">LoRaDemod::prng6</a>(<span class="keywordtype">char</span>* inout, <span class="keywordtype">int</span> size)</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;{</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> otp[] = {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">//explicit mode</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="stringliteral">&quot;cOGGg7CM2=b5a?&lt;`i;T2of5jDAB=2DoQ9ko?h_RLQR4@Z\\`9jY\\PX89lHX8h_R]c_^@OB&lt;0`W08ik?Mg&gt;dQZf3kn5Je5R=R4h[&lt;Ph90HHh9j;h:mS^?f:lQ:GG;nU:b?WFU20Lf4@A?`hYJMnW\\QZ\\AMIZ&lt;h:jQk[PP&lt;`6[Z&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// implicit mode (offset 2 symbols)</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="stringliteral">&quot;5^ZSm0=cOGMgUB=bNcb&lt;@a^T;_f=6DEB]2ImPIKg:j]RlYT4YZ&lt;`9hZ\\PPb;@8X8i]Zmc_6B52\\8oUPHIcBOc&gt;dY?d9[n5Lg]b]R8hR&lt;0`T008h9c9QJm[c?a:lQEGa;nU=b_WfUV2?V4@c=8h9B9njlQZDC@9Z&lt;Q8\\iiX\\Rb6k:iY&quot;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    };</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a>, maxchars;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    maxchars = <span class="keyword">sizeof</span>( otp );</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">if</span> (size &lt; maxchars)</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        maxchars = size;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; maxchars; i++)</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        inout[i] ^= (otp[i] - 48);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="ttc" id="classLoRaDemod_html_addeae1bb2a2d6c00227b5788f819c7cf"><div class="ttname"><a href="../../d7/d10/classLoRaDemod.html#addeae1bb2a2d6c00227b5788f819c7cf">LoRaDemod::toGray</a></div><div class="ttdeci">short toGray(short bin)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/lorabits_8h_source.html#l00036">lorabits.h:36</a></div></div>
<div class="ttc" id="classLoRaDemod_html_a01918e51fd137fd09c4a0db3b5b935f0"><div class="ttname"><a href="../../d7/d10/classLoRaDemod.html#a01918e51fd137fd09c4a0db3b5b935f0">LoRaDemod::prng6</a></div><div class="ttdeci">void prng6(char *inout, int size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/lorabits_8h_source.html#l00063">lorabits.h:63</a></div></div>
<div class="ttc" id="decimators_8h_html_a38832fab42830736aeebf02e971a4959"><div class="ttname"><a href="../../d6/d6f/decimators_8h.html#a38832fab42830736aeebf02e971a4959">i</a></div><div class="ttdeci">int32_t i</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d6f/decimators_8h_source.html#l00244">decimators.h:244</a></div></div>
<div class="ttc" id="classLoRaDemod_html_ac0ab0c757e48da317954cfd3b1bd770d"><div class="ttname"><a href="../../d7/d10/classLoRaDemod.html#ac0ab0c757e48da317954cfd3b1bd770d">LoRaDemod::interleave6</a></div><div class="ttdeci">void interleave6(char *inout, int size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/lorabits_8h_source.html#l00014">lorabits.h:14</a></div></div>
<div class="ttc" id="classLoRaDemod_html_a9495b2c00add0f711d7af99c59954f40"><div class="ttname"><a href="../../d7/d10/classLoRaDemod.html#a9495b2c00add0f711d7af99c59954f40">LoRaDemod::hamming6</a></div><div class="ttdeci">void hamming6(char *inout, int size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/lorabits_8h_source.html#l00042">lorabits.h:42</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Aug 2 2019 17:56:30 for SDRAngel by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
